{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Upload File | Secure File System</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }

    body.upload-page {
        height: 100vh;
        background: radial-gradient(circle at top left, #0f2027, #203a43, #2c5364);
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 40px;
        overflow: hidden;
    }

    /* Floating Particles */
    .particle {
        position: absolute;
        width: 10px;
        height: 10px;
        background: rgba(255,255,255,0.15);
        border-radius: 50%;
        animation: float 20s linear infinite;
    }

    @keyframes float {
        0% { transform: translateY(100vh) translateX(0) rotate(0deg); opacity: 0; }
        50% { opacity: 0.3; }
        100% { transform: translateY(-100vh) translateX(200px) rotate(360deg); opacity: 0; }
    }

    /* Glassmorphism Container */
    .centered-container {
        position: relative;
        z-index: 1;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(15px);
        border-radius: 20px;
        padding: 50px 40px;
        width: 95%;
        max-width: 800px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        border: 1px solid rgba(255,255,255,0.2);
        text-align: center;
        color: #fff;
    }

    h2, h3 {
        margin-bottom: 20px;
    }

    input[type="file"] {
        padding: 12px;
        border-radius: 10px;
        border: none;
        width: 100%;
        margin-bottom: 20px;
        background: rgba(255,255,255,0.15);
        color: #fff;
        font-size: 16px;
        transition: 0.3s;
    }

    input[type="file"]:focus {
        background: rgba(255,255,255,0.25);
        box-shadow: 0 0 10px #667eea;
        outline: none;
    }

    .glossy-form button,
    .glossy-form input[type="submit"] {
        padding: 12px 25px;
        margin: 5px;
        font-size: 16px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: #fff;
        transition: 0.3s;
    }

    .glossy-form button:hover,
    .glossy-form input[type="submit"]:hover {
        background: linear-gradient(135deg, #556cd6, #5e35b1);
        box-shadow: 0 0 15px #667eea;
    }

    textarea, iframe {
        width: 100%;
        margin-top: 10px;
        display: none;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 10px;
        background: rgba(255,255,255,0.1);
        color: #fff;
        font-family: monospace;
    }

    #pptxNotice {
        display: none;
        color: #ff4c4c;
        font-weight: bold;
        margin-top: 10px;
    }

    a {
        text-decoration: none;
        font-weight: bold;
        color: #667eea;
        margin-right: 10px;
        transition: 0.3s;
    }

    a:hover {
        text-decoration: underline;
        color: #556cd6;
    }
</style>
</head>
<body class="upload-page">

    <!-- Floating particles -->
    <div class="particle" style="left:5%; animation-duration: 18s;"></div>
    <div class="particle" style="left:25%; animation-duration: 22s;"></div>
    <div class="particle" style="left:50%; animation-duration: 20s;"></div>
    <div class="particle" style="left:70%; animation-duration: 25s;"></div>
    <div class="particle" style="left:90%; animation-duration: 30s;"></div>

    <div class="centered-container">
        <h2>Welcome, {{ username }}!</h2>
        <h3>Upload Encrypted File</h3>

        <form method="POST" action="{% url 'upload_file' %}" enctype="multipart/form-data" class="glossy-form">
            {% csrf_token %}
            <input type="file" name="file" id="fileInput" required><br>
            <button type="button" onclick="previewFile()">üëÅ Preview</button>
            <input type="submit" value="‚¨Ü Upload">
        </form>

        <h3>Preview:</h3>
        <textarea id="previewText" readonly>No file previewed yet.</textarea>
        <iframe id="previewPDF" height="400px"></iframe>
        <div id="pptxNotice">‚ö† PPTX preview not supported in browser. Please upload and view after decryption.</div>

        <br><br>
        <div>
            <a href="{% url 'list_files' %}">üìÇ View Files</a>|
            <a href="{% url 'logout' %}">üö™ Logout</a>
        </div>
    </div>

<script>
function previewFile() {
    const input = document.getElementById('fileInput');
    const file = input.files[0];
    const textPreview = document.getElementById('previewText');
    const pdfPreview = document.getElementById('previewPDF');
    const pptxNotice = document.getElementById('pptxNotice');

    if (!file) return alert("Please select a file");

    const ext = file.name.split('.').pop().toLowerCase();
    const reader = new FileReader();

    textPreview.style.display = 'none';
    pdfPreview.style.display = 'none';
    pptxNotice.style.display = 'none';

    if (ext === 'pdf') {
        reader.onload = e => {
            const blob = new Blob([e.target.result], { type: 'application/pdf' });
            pdfPreview.src = URL.createObjectURL(blob);
            pdfPreview.style.display = 'block';
        };
        reader.readAsArrayBuffer(file);
    } else if (['txt','csv','md'].includes(ext)) {
        reader.onload = e => {
            textPreview.value = e.target.result;
            textPreview.style.display = 'block';
        };
        reader.readAsText(file);
    } else if (ext === 'pptx') {
        pptxNotice.style.display = 'block';
    } else {
        textPreview.value = "‚ùå Unsupported file type for preview.";
        textPreview.style.display = 'block';
    }
}
</script>
</body>
</html>
